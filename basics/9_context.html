<!DOCTYPE html>
<html>
  <head>basics exercise#9: context</head></br>
  <body>
    -------------------------------------------------------------------------------------------------</br>
    <ul>
      <li>All methods in Javascript have a context, which is the class in which they are.</li>
      <li>The context object is accessed via 'this'.</li>
      <li>It is very useful to be able to associate a function with an object.</li>
      <li>There are 3 methods that can change context: apply(), call() and bind()</li>
    </ul>

    <h4>context, part#1</h4>

    <p>
      <b>apply()</b>
      <ul>
        <li>is called on a function</li>
        <li>takes only two arguments, which are objects</li>
        <li>first argument is the context object</li>
        <li>second argument is an array (i.e. seen as an arguments object)</li>
        <li>useful for a collection, as opposed to discrete values</li></br>
      </ul>
    </p>

    var showMeThis = function(n1, n2) {</br></br>

    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log();</br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(n1 + " and " + n2);</br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(this);</br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log("this === window.....");</br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(this === window);</br></br>

    };</br></br>

    showMeThis(99, 66);</br>
    showMeThis.apply("boo apply", [99, 66], [123, 543]);</br>

    <script>

      console.log("part 1: using apply()");

      var showMeThis = function(n1, n2){

        console.log();
        console.log(n1 + " and " + n2);
        console.log(this);
        console.log("this === window.....");
        console.log(this === window);

      };

      showMeThis(99, 66);
      showMeThis.apply("boo apply", [99, 66], [123, 543]);

    </script>

    -------------------------------------------------------------------------------------------------</br>
    <h4>context, part#2</h4>

    <p>
      <b>call()</b>
      <ul>
        <li>is called on a function</li>
        <li>takes any number of arguments</li>
        <li>first argument is the context object</li>
        <li>any number of subsequent parameters can be passed as discrete values</li>
      </ul>
    </p>

    var showMeThis2 = function(n1, n2) {</br></br>

    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log();</br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(n1 + " and " + n2);</br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(this);</br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log("this === window......");</br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(this === window);</br></br>

    };</br></br>

    showMeThis2(99, 66);</br>
    showMeThis2.call("boo call", [99, 66], [123, 543]);</br>

    <script>

      console.log("---------------------------------------");
      console.log("part 2: using call()");

      var showMeThis2 = function(n1, n2){

        console.log();
        console.log(n1 + " and " + n2);
        console.log(this);
        console.log("this === window......");
        console.log(this === window);

      };

      showMeThis2(99, 66);
      showMeThis2.call("boo call", [99, 66], [123, 543]);

    </script>

    -------------------------------------------------------------------------------------------------</br>
    <h4>context, part#3.1</h4>

    <p>
      <b>bind()</b>
      <ul>
        <li>is called on a function</li>
        <li>unlike call() and apply(), it does not execute the function</li>
        <li>takes a context object as its only argument</li>
        <li>binds the function to the object as its context</li>
        <li>returns a bound function</li>
      </ul>
    </p>

    var obj = {</br></br>

    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;showMeThis3 : function(n1, n2) {</br></br>

    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log();</br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(n1 + " and " + n2);</br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(this);</br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log("this === window......");</br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(this === window);</br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log("this === obj......");</br>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(this === obj);</br></br>

    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</br></br>

    }</br></br>

    obj.showMeThis3(99, 66);</br>
    var windowBoundShowMeThis = obj.showMeThis3.bind(window);</br>
    windowBoundShowMeThis(99,66);</br>

    <script>
      console.log("---------------------------------------");
      console.log("part 3: using bind()");

      var obj = {

          showMeThis3 : function(n1, n2) {

              console.log();
              console.log(n1 + " and " + n2);
              console.log(this);
              console.log("this === window......");
              console.log(this === window);
              console.log("this === obj......");
              console.log(this === obj);

          }

      }

    //  showMeThis3(99, 66); spits out 'RefernceError: showMeThis3 is not defined'
      obj.showMeThis3(99, 66);
      var windowBoundShowMeThis = obj.showMeThis3.bind(window);
      windowBoundShowMeThis(99,66);
    </script>
      <h4>context, part#3.2</h4>

      <p>
        <b>showing usefulness of context in event listener example</b>
        <ul>
          <li>specifying local action using a general listener</li>
          </ul>
      </p>

      $('button').on('click', obj.showMeThis3);</br></br>
      $('li').on('click', function() {</br></br>

      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var clickedCount = parseInt($(this).find('span').html());</br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(this).find('span').html(clickedCount + 1);</br></br>

      })</br></br>

    <button>i am button</button>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
    <ul>
      <li>you clicked me <span>0</span> times</li>
      <li>you clicked me <span>0</span> times</li>
      <li>you clicked me <span>0</span> times</li>
    </ul>
    <script>
      $('button').on('click', obj.showMeThis3);
      $('li').on('click', function() {

        var clickedCount = parseInt($(this).find('span').html());
        $(this).find('span').html(clickedCount + 1);

      });

    </script>

    <h4>context, part#3.3</h4>

    <p>
      <b>showing common error (and how to avoid it) with event listener example</b></br></br>
      In the example below, if you are given the requirement that 'div1' must slideToggle down
      </b>before</b> 'button2' toggles to active (not actually visible here), then you move</br>
      the toggleClass() statement down into a callback function which is added into slideToggle()'s parameter.</br>
      However, the context of 'this' has now changed. 'This' will instead be pointing at div1 instead of button2.</br></br>
      You can address this new problem in one of two ways:</br></br>
      1. assign 'this' to another variable (e.g. '_this'), which you can then refer to in the callback function instead of 'this':</br></br>

      $('#button1').on('click', function() {</br></br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var _this = this;</br></br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$('#div1').slideToggle(300, function() {</br></br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(_this).toggleClass("active");</br></br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});</br></br>
      });</br></br>
      <b>Or</b></br></br>
      2. attach a bind() function call at the end of the slideToggle():</br></br>
      $('#button2').on('click', function() {</br></br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$('#div2').slideToggle(300, function() {</br></br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$(this).toggleClass("active");</br></br>
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}.bind(this));</br></br>
      });</br></br>

    </p>

    <p>
      <button id="button1">button1</button>
    </p>

    <div id="div1" style="background:#999;margin-top:10px;font-weight:bold;text-align:center;display:none;">
      <div class="content">content</div>
    </div>
    </br></br></br></br></br></br>
    <script>

      $('#button1').on('click', function() {

        var _this = this;

        $('#div1').slideToggle(300, function() {

          $(_this).toggleClass("active");

        });

      });

    </script>

    <p>
      <button id="button2">button2</button>
    </p>

    <div id="div2" style="background:#999;margin-top:10px;font-weight:bold;text-align:center;display:none;">
      <div class="content2">content</div>
    </div>
    </br></br></br></br></br></br>

    <script>

      $('#button2').on('click', function() {

        $('#div2').slideToggle(300, function() {

          $(this).toggleClass("active");

        }.bind(this));

      });

    </script>

  </body>

</html>
